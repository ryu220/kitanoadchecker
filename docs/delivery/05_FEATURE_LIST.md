# 機能一覧 - 広告文リーガルチェックツール

**バージョン**: v1.0
**最終更新**: 2025年10月30日

---

## 📋 目次

1. [コア機能](#コア機能)
2. [チェック機能](#チェック機能)
3. [対応商品](#対応商品)
4. [ナレッジベース](#ナレッジベース)
5. [API機能](#api機能)
6. [ユーティリティ機能](#ユーティリティ機能)
7. [今後の拡張性](#今後の拡張性)

---

## コア機能

### 1. セグメント自動分割

**機能**: 広告文を意味単位で自動的に分割

**技術**:
- AI（Gemini 1.5 Pro）による文脈理解
- 改行・句読点・意味の区切りを考慮
- セグメントタイプ自動判定（claim / explanation）

**対応入力形式**:
- プレーンテキスト
- 改行を含む長文
- 最大10,000文字まで

**出力**:
```json
{
  "segments": [
    {
      "id": "segment-1",
      "text": "Amazon・楽天で1位を獲得した人気商品です。",
      "type": "explanation",
      "position": {
        "start": 0,
        "end": 28,
        "line": 1
      }
    }
  ]
}
```

### 2. 法令チェックエンジン

**機能**: 各セグメントを薬機法・景表法・社内ルールでチェック

**チェックレイヤー**:

| レイヤー | チェック内容 | 処理速度 |
|---------|------------|---------|
| **Layer 1: NGキーワードバリデーター** | 条件付きNG / 絶対NG / 文脈依存NG | 高速（< 1秒） |
| **Layer 2: 注釈解析器** | 注釈の有無・内容・形式チェック | 高速（< 1秒） |
| **Layer 3: RAG検索** | Vector DB（ChromaDB）から関連ナレッジ検索 | 中速（1-2秒） |
| **Layer 4: Gemini AI判定** | 高度な文脈理解・最終判定 | 低速（5-10秒） |

**特徴**:
- 4層の段階的チェック
- 重複除去フィルター（Gemini / NGキーワード間の重複を自動除去）
- 高速キャッシング

### 3. 判定結果生成

**機能**: チェック結果をわかりやすく整形

**出力内容**:
- 適合 / 不適合の判定
- 違反タイプ（薬機法 / 景表法 / 社内ルール）
- 重大度（重大 / 中程度 / 軽度）
- 検出されたキーワード
- 違反理由の詳細説明
- 根拠ナレッジファイルへの参照
- 具体的な修正案

**レポート形式**:
- JSON（API利用時）
- HTML（Web UI表示用）
- Markdown（エクスポート用）

---

## チェック機能

### 1. 薬機法チェック

#### 1.1 医薬的効果効能チェック

**検出対象**:
- 「治る」「効く」「改善」等の医薬品的表現
- 「殺菌」「消毒」（医薬部外品の場合、注釈が必須）
- 「白癬菌」「爪水虫」等の病名想起表現

**例**:
```
NG: 爪水虫を治す
OK: 爪を清潔に保つ（医薬部外品の承認範囲内）
```

#### 1.2 浸透表現チェック

**検出対象**: 「浸透」表現

**ルール**:
- **化粧品**: 「※角層まで」の注釈が必須
- **SH商品（医薬部外品）**: 「※背爪表面に」の注釈が必須
- **HA商品**: 「※角層まで」の注釈が必須

**例**:
```
NG: 浸透して効果を発揮
OK: 浸透※して効果を発揮 ※角層まで
```

#### 1.3 特定成分の特記表示チェック

**検出対象**:
- EGF、FGF、幹細胞 等の略称使用
- ヒアルロン酸の特記表示

**ルール**:
- 略称は正式名称との併記が推奨
- 「ヒアルロン酸」には「※うるおい成分」等の注釈

#### 1.4 専用表現チェック

**検出対象**: 「専用」表現

**ルール**:
- 他の用途に使用できないことが明確な場合のみ使用可
- 曖昧な「専用」表現はNG

#### 1.5 医療関係者推せんチェック

**検出対象**: 「医師推薦」「医師監修」等

**ルール**:
- 原則NG（薬機法違反の可能性）
- 使用する場合は詳細な条件クリアが必須

### 2. 景表法チェック

#### 2.1 ランキング・順位表現チェック ⭐ NEW

**検出対象**:
- 「1位」「第1位」「第一位」「一位」
- 「NO.1」「No.1」「ナンバーワン」「ナンバー1」
- 「トップ」「TOP」（ランキング文脈）

**ルール**:
- **必須**: 調査機関・調査期間・調査対象のエビデンス
- 注釈で明記が必須

**例**:
```
NG: Amazon・楽天で1位を獲得
OK: Amazon・楽天で1位※を獲得
    ※2024年1月Amazon・楽天ランキング調査
```

#### 2.2 保証表現チェック

**検出対象**: 「全額返金保証」「満足保証」等

**ルール**:
- 画像・動画内: 注釈必須
- 広告文: 遷移先に詳細があればOK

**例**:
```
画像内の場合:
NG: 全額返金保証
OK: 全額返金保証※ ※詳細は遷移先ページに記載
```

#### 2.3 限定表現チェック

**検出対象**: 「今なら」「期間限定」「数量限定」等

**ルール**:
- 常時提供している場合は優良誤認（景表法違反）
- 実際に限定されている場合のみ使用可

#### 2.4 ギネス世界記録™チェック

**検出対象**: 「ギネス世界記録™」表現

**ルール**:
- 認定日から5年間のみ使用可
- 認定日の明記が推奨

### 3. 社内ルールチェック

#### 3.1 注釈の入れ方チェック

**ルール**:
- 画像・動画内の表現には必ず注釈
- 広告文の場合、遷移先に詳細があればOK

#### 3.2 ステマ規制チェック

**ルール**:
- PR表記の位置・サイズ・色を確認
- 広告であることが明確に分かる表示

#### 3.3 商品名表記チェック

**検出対象**: ※印付き商品名（例: 商品名※）

**ルール**:
- ※印の注釈内容を確認
- 正しい表記ルールに従う

### 4. 文脈依存チェック

#### 4.1 クマ表現チェック

**ルール**:
- 「クマ」単体: NG（動物か目元か不明）
- 「目元のクマ」: OK（部位が明確）

**例**:
```
NG: クマに悩む方へ
OK: 目元のクマに悩む方へ
```

#### 4.2 ビフォーアフター写真チェック

**ルール**:
- 撮影条件の明記
- 加工の有無の明示
- 個人の感想である旨の明記

#### 4.3 体験談チェック

**ルール**:
- 「個人の感想です」の明記
- 効果を保証するものではない旨の明記

---

## 対応商品

### 高度対応商品（2商品）

#### HA（ヒアロディープパッチ）

**専用ナレッジ**: 11ファイル

**専用チェック項目**:
- ニードル技術の表現
- ヒアルロン酸の浸透表現（※角層まで）
- マイクロニードル形状の説明
- 貼付時間・使用頻度の表現

**商品分類**: 化粧品

#### SH（クリアストロングショット アルファ）

**専用ナレッジ**: 8ファイル

**専用チェック項目**:
- 殺菌表現（※消毒の作用機序として）
- 浸透表現（※背爪表面に）
- 爪水虫想起表現（「ぶ厚い」「硬い」「汚い爪」等はNG）
- 白癬菌の表現
- 医薬部外品の承認範囲内か

**商品分類**: 医薬部外品（新指定医薬部外品）

### 基本対応商品（40商品）

**共通ナレッジ**: 100+ファイル

**チェック項目**:
- 薬機法・景表法の基本チェック
- 社内ルールの基本チェック
- 一般的なNGキーワード

---

## ナレッジベース

### 構成

```
knowledge/
├── common/         # 全商品共通（100+ファイル）
│   ├── 薬機法関連（20ファイル）
│   ├── 景表法関連（30ファイル）
│   ├── 社内ルール（50ファイル）
│   └── その他
├── HA/            # HA商品専用（11ファイル）
└── SH/            # SH商品専用（8ファイル）
```

### 総ドキュメント数

| カテゴリ | ファイル数 | Vector化後 |
|---------|-----------|-----------|
| **共通ナレッジ** | 100+ | 約1,200 chunks |
| **HA専用** | 11 | 約70 chunks |
| **SH専用** | 8 | 約60 chunks |
| **合計** | 119+ | **約1,333 chunks** |

### 優先度マッピング

**システム**: `config/knowledge-priority-mapping.csv`

| 優先度 | 意味 | 例 |
|--------|------|---|
| 10 | 最高（商品専用ルール） | HA, SH専用ナレッジ |
| 5 | 高（重要な共通ルール） | 薬機法基本、景表法基本 |
| 3 | 中（一般的なルール） | 社内ルール |
| 1 | 低（参考情報） | 事例集 |

### Vector DB技術

**システム**: ChromaDB

**埋め込みモデル**: OpenAI `text-embedding-3-small`

**検索方式**:
- Cosine Similarity
- Top-K検索（K=5）
- 閾値: 類似度0.5以上

**メタデータ**:
```json
{
  "source": "knowledge/common/37_エビデンス表記について.txt",
  "priority": 5,
  "category": "景表法",
  "product": "common"
}
```

---

## API機能

### 提供API

#### 1. セグメント分割API

**エンドポイント**: `POST /api/v2/segment`

**機能**: 広告文をセグメント分割

**レスポンスタイム**: 5-10秒

#### 2. 評価API

**エンドポイント**: `POST /api/v2/evaluate-batch`

**機能**: セグメント群を一括評価

**レスポンスタイム**: 10-30秒（セグメント数により変動）

#### 3. レポート生成API

**エンドポイント**: `POST /api/v2/report`

**機能**: 判定結果をレポート形式で生成

**レスポンスタイム**: < 1秒

#### 4. ヘルスチェックAPI

**エンドポイント**: `GET /api/health`

**機能**: システム状態確認

**レスポンス**:
```json
{
  "status": "ok",
  "timestamp": "2025-10-30T12:00:00Z",
  "services": {
    "chroma": "connected",
    "gemini": "available"
  }
}
```

### API認証

**方式**: APIキーベース

**ヘッダー**:
```
Authorization: Bearer your-api-key
```

または

**ボディ**:
```json
{
  "apiKey": "your-api-key"
}
```

---

## ユーティリティ機能

### 1. ナレッジベース初期化

**コマンド**: `npm run setup:vector-db`

**機能**:
- knowledge/ ディレクトリ読み込み
- ドキュメント分割・埋め込み生成
- ChromaDBへの格納

**実行時間**: 3-5分

### 2. 環境チェックツール

**コマンド**: `npm run check:environment`

**機能**:
- Node.js / npm バージョン確認
- Docker 起動確認
- ChromaDB 接続確認
- 環境変数確認
- Vector DB 初期化状態確認

### 3. 開発サーバー

**コマンド**: `npm run dev`

**機能**:
- Hot Reload
- TypeScript型チェック
- エラーオーバーレイ

### 4. プロダクションビルド

**コマンド**: `npm run build`

**機能**:
- 最適化されたプロダクションビルド
- 静的ファイル生成
- Tree Shaking

---

## 今後の拡張性

### 計画中の機能

#### 1. バッチ処理

**機能**: 複数広告文の一括チェック

**予定**: v1.1

#### 2. 履歴管理

**機能**: 過去のチェック履歴を保存・検索

**予定**: v1.2

#### 3. カスタムルール

**機能**: ユーザー独自のチェックルールを追加

**予定**: v1.3

#### 4. レポートエクスポート

**機能**: PDF / Excel形式でのレポート出力

**予定**: v1.2

#### 5. Webhook連携

**機能**: 外部システムへの判定結果通知

**予定**: v1.3

### 技術的改善

#### 1. パフォーマンス最適化

- キャッシング強化
- 並列処理の導入
- レスポンスタイム50%削減目標

#### 2. 精度向上

- Gemini Flashへの部分移行（高速化）
- RAG検索アルゴリズム改善
- ファインチューニング検討

#### 3. 運用性向上

- ログ管理強化
- モニタリングダッシュボード
- 自動アラート機能

---

## まとめ

### 現在の機能セット

| カテゴリ | 機能数 |
|---------|--------|
| **コア機能** | 3 |
| **チェック機能** | 4カテゴリ、15+サブ機能 |
| **対応商品** | 42商品 |
| **ナレッジベース** | 1,333 chunks |
| **API** | 4エンドポイント |
| **ユーティリティ** | 4機能 |

### システムの強み

✅ **高精度**: 4層チェック + 1,333件ナレッジ
✅ **高速**: NGキーワードチェック < 1秒
✅ **柔軟性**: 商品別ルール + 共通ルール
✅ **拡張性**: ナレッジ追加・商品追加が容易
✅ **トレーサビリティ**: 判定根拠が明確

---

**作成日**: 2025年10月30日
**対象バージョン**: v1.0
**最終更新**: 機能一覧確定
