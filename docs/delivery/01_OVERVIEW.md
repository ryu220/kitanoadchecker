# 広告文リーガルチェックツール - システム概要説明書

**納品日**: 2025年10月30日
**バージョン**: v1.0
**対象**: 客先担当者様（非技術者含む）

---

## 📋 目次

1. [システム概要](#システム概要)
2. [主な機能](#主な機能)
3. [システム構成](#システム構成)
4. [導入効果](#導入効果)
5. [対応商品](#対応商品)
6. [チェック項目](#チェック項目)
7. [最新の改善内容（Issue #36対応）](#最新の改善内容issue-36対応)
8. [今後の運用](#今後の運用)

---

## システム概要

### 🎯 目的

広告文が**薬機法・景表法・社内ルール**に適合しているかを自動的にチェックし、問題箇所を指摘して修正案を提示するシステムです。

### 💡 特徴

| 特徴 | 説明 |
|------|------|
| **自動判定** | 広告文を入力するだけで、法令違反・リスクを自動検出 |
| **詳細な根拠提示** | 違反理由と参照すべきナレッジファイルを明示 |
| **修正案提示** | 具体的な修正例を提示し、修正作業を効率化 |
| **42商品対応** | HA（ヒアロディープパッチ）、SH（クリアストロングショット）など42商品に対応 |
| **高精度** | 1,333件のナレッジベース + AI（Gemini）による高精度判定 |

---

## 主な機能

### 1. セグメント分割

広告文を意味単位で自動分割します。

**例**:
```
入力: "Amazon・楽天で1位を獲得した人気商品です。医師も認める効果。"

↓ セグメント分割

セグメント1: "Amazon・楽天で1位を獲得した人気商品です。"
セグメント2: "医師も認める効果。"
```

### 2. 法令チェック

各セグメントを以下の観点でチェック:

| チェック項目 | 内容 |
|-------------|------|
| **薬機法違反** | 医薬品的効果効能の表現、承認外効果の訴求など |
| **景表法違反** | 優良誤認（根拠なき1位表記など）、有利誤認（誤解を招く価格表示） |
| **社内ルール違反** | 注釈漏れ、特定表現の使用制限など |

### 3. 判定結果

| 判定 | 意味 |
|------|------|
| **適合** | 問題なし |
| **不適合** | 法令違反・リスクあり（重大度: 重大 / 中程度 / 軽度） |

### 4. 修正案提示

不適合の場合、具体的な修正案を提示:

```
【検出内容】
「Amazon・楽天で1位を獲得した人気商品です。」

【問題】
景表法違反（重大）
ランキング・順位表現には景表法により調査機関・調査期間・調査対象を明記したエビデンスが必須です

【根拠】
knowledge/common/37_エビデンス表記について.txt

【修正案】
「Amazon・楽天で1位※を獲得した人気商品です。
※2024年1月Amazon・楽天ランキング調査」
```

---

## システム構成

### アーキテクチャ

```
┌─────────────────┐
│  ユーザー画面   │  Next.js（React）
│  (Web UI)       │
└────────┬────────┘
         │
         ↓ HTTP Request
┌─────────────────┐
│  APIサーバー     │  Next.js API Routes
│  (/api/v2/*)    │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  チェックエンジン │
│  ├ NGキーワード  │  TypeScript（厳密な型定義）
│  │  バリデーター  │
│  ├ 注釈解析      │
│  ├ 文脈依存判定  │
│  └ RAG検索      │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  ナレッジベース  │  1,333ドキュメント
│  (ChromaDB)     │  - 薬機法・景表法
│  Vector Store   │  - 社内ルール
│                 │  - 商品別ルール
└─────────────────┘
         │
         ↓
┌─────────────────┐
│  Gemini AI      │  Google Gemini 1.5 Pro
│  (最終判定)      │  高度な文脈理解
└─────────────────┘
```

### 技術スタック

| レイヤー | 技術 |
|---------|------|
| **フロントエンド** | Next.js 14, React, TypeScript, Tailwind CSS |
| **バックエンド** | Next.js API Routes, TypeScript（strict mode） |
| **Vector DB** | ChromaDB（1,333ドキュメント） |
| **AI** | Google Gemini 1.5 Pro API |
| **デプロイ** | Railway（本番環境）、Docker（ローカル開発） |

---

## 導入効果

### ✅ 導入前の課題

| 課題 | 影響 |
|------|------|
| 手作業によるチェック | 時間がかかる（1広告文あたり30分～1時間） |
| 見落としリスク | 人為的ミスによる法令違反リスク |
| 属人化 | 担当者のスキルに依存 |
| ナレッジ参照困難 | 1,333件のルールから該当箇所を探すのが困難 |

### ✅ 導入後の効果

| 効果 | 数値 |
|------|------|
| **チェック時間短縮** | 30分～1時間 → **約3分** |
| **精度向上** | 人為的ミス削減、見落とし防止 |
| **属人化解消** | 誰でも同じ品質のチェックが可能 |
| **ナレッジ活用** | 1,333件のルールから自動的に該当箇所を検索・提示 |
| **トレーサビリティ** | 判定根拠が明確（監査対応） |

---

## 対応商品

### 高度対応商品（2商品）

| 商品コード | 商品名 | 特徴 |
|-----------|--------|------|
| **HA** | ヒアロディープパッチ | 商品別ルール + 専用ナレッジ（11ファイル） |
| **SH** | クリアストロングショット アルファ | 商品別ルール + 専用ナレッジ（8ファイル） |

### 基本対応商品（40商品）

共通ルール + 商品マスタによる基本チェック

---

## チェック項目

### 1. 薬機法チェック

| カテゴリ | 例 |
|---------|---|
| **医薬的効果効能** | 「治る」「効く」「改善」等の医薬品的表現 |
| **特定成分の特記表示** | EGF、FGF、幹細胞等の成分名の使用制限 |
| **浸透表現** | 「浸透」には「※角層まで」等の注釈が必須 |
| **殺菌表現** | 「殺菌」には「※消毒の作用機序として」等の注釈が必須 |
| **医療関係者推せん** | 医師の推薦は原則NG |

### 2. 景表法チェック

| カテゴリ | 例 |
|---------|---|
| **ランキング・順位表現** | 「1位」「NO.1」にはエビデンス（調査機関・期間・対象）が必須 ※Issue #36で修正 |
| **保証表現** | 「全額返金保証」には詳細条件の明示が必須 |
| **限定表現** | 「今なら」「期間限定」は常時提供と誤認されないように |
| **ギネス世界記録™** | 使用期間制限あり（認定日から5年間） |

### 3. 社内ルールチェック

| カテゴリ | 例 |
|---------|---|
| **注釈の入れ方** | 画像・動画内の表現には必ず注釈が必要 |
| **ステマ規制** | PR表記の適切な位置・サイズ |
| **商品名表記** | ※印付き商品名の正しい表記ルール |

### 4. 文脈依存チェック

| カテゴリ | 例 |
|---------|---|
| **クマ表現** | 「クマ」単体はNG、「目元のクマ」はOK |
| **医薬部外品** | 承認された効能効果の範囲内か |
| **ビフォーアフター** | 写真の撮影条件、加工の有無を明記 |

---

## 最新の改善内容（Issue #36対応）

### 🔧 修正内容

**問題**: 「Amazon・楽天で1位を獲得した人気商品です。」がチェックされず、適合判定になっていた

**原因**: ランキング・順位表現のキーワード定義が不足していた

**修正**: `lib/ng-keywords/conditional-ng.ts` にランキングキーワードを追加

### ✅ 修正後の動作

```
【入力】
"Amazon・楽天で1位を獲得した人気商品です。"

【修正前】
→ 適合（問題検出されず） ❌

【修正後】
→ 不適合（景表法違反） ✅

【検出内容】
景表法違反（重大）
ランキング・順位表現には景表法により調査機関・調査期間・調査対象を
明記したエビデンスが必須です

【修正案】
「Amazon・楽天で1位※を獲得した人気商品です。
※2024年1月Amazon・楽天ランキング調査」
```

### 📊 追加されたチェックパターン

| パターン | 検出対象 |
|---------|---------|
| **1位表現** | 「1位」「第1位」「第一位」「一位」 |
| **NO.1表現** | 「NO.1」「No.1」「ナンバーワン」「ナンバー1」「No1」 |
| **トップ表現** | 「トップ」「TOP」（ランキング文脈） |

### 🔒 デグレーション防止

- 既存のチェック性能を維持
- 重複フィルターを有効化（Geminiとの重複検出を防止）
- 完全な復元ポイントを `RESTORE_POINT_20251030.md` に記録

### 📝 詳細ドキュメント

詳細な修正内容・テストケース・復元手順は以下を参照:
- `RESTORE_POINT_20251030.md` - 完全な復元ポイント
- `docs/delivery/04_ISSUE_36_FIX.md` - Issue #36修正詳細

---

## 今後の運用

### 日常運用

1. **広告文チェック**: Web UIから広告文を入力してチェック実行
2. **結果確認**: 不適合箇所と修正案を確認
3. **修正作業**: 提示された修正案を参考に広告文を修正
4. **再チェック**: 修正後の広告文を再度チェック

### メンテナンス

| 項目 | 頻度 | 内容 |
|------|------|------|
| **ナレッジ更新** | 法改正時 | knowledge/ ディレクトリにファイル追加・更新 |
| **商品追加** | 新商品発売時 | 商品マスタ + ナレッジ追加 |
| **ルール追加** | 社内ルール変更時 | NGキーワード定義更新 |
| **システム更新** | 月次 | npm パッケージ更新、セキュリティパッチ適用 |

### サポート体制

| サポート内容 | 連絡先 |
|------------|-------|
| システム障害 | GitHub Issues |
| 使用方法の質問 | 運用マニュアル参照 |
| 機能追加要望 | GitHub Issues |

---

## 📚 関連ドキュメント

| ドキュメント | 内容 |
|------------|------|
| `02_SETUP_GUIDE.md` | セットアップ手順（開発環境） |
| `03_DEPLOYMENT_RAILWAY.md` | 本番環境デプロイ手順 |
| `04_ISSUE_36_FIX.md` | Issue #36修正詳細 |
| `05_OPERATION_MANUAL.md` | 日常運用マニュアル |
| `06_TROUBLESHOOTING.md` | トラブルシューティング |
| `RESTORE_POINT_20251030.md` | システム完全復元ポイント |

---

## 📞 お問い合わせ

ご不明点がございましたら、以下までお問い合わせください。

- **GitHub Issues**: https://github.com/ryu220/kitanoadchecker/issues
- **ドキュメント**: `docs/delivery/` ディレクトリ内の各種マニュアル

---

**納品元**: Claude Code
**納品日**: 2025年10月30日
**バージョン**: v1.0
